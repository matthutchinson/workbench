#!/bin/sh

set -e

NEW_JWT=$(bin/rake dev:ucp_agentic_checkout:generate_jwt | ruby -e 'puts STDIN.read.split("\n")[4]')
echo "------------------------- New UCP JWT token ---------------------------"
echo $NEW_JWT
echo "----------------------- (copied to clipboard) -------------------------"

echo "$NEW_JWT" | pbcopy

sed -i "/LOCAL_GLOBAL_API_ACCESS_TOKEN/c\LOCAL_GLOBAL_API_ACCESS_TOKEN=$NEW_JWT" ~/.config/insomnia/ucp.env
echo "\n... applied to LOCAL_GLOBAL_API_ACCESS_TOKEN in ~/.config/insomnia/ucp.env"
